<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <title>Service Manager API</title>
    <script src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-2.0.3.min.js"></script>
    <script src="Scripts/customer.js"></script>
    <script src="Scripts/common.js"></script>
    <script>
        function getServicesFromDB() {
            var customerId = $('#customerId').val();

            $.ajax({
                type: 'GET',
                url: uri + '/' + customerId + '/GetCustomerOrders',
                contentType: 'application/json',
                dataType: 'json',
                success: function (data) {
                    $();
                    var json = $.parseJSON(JSON.stringify(data));
                    var html = '';
                    for (var i = 0; i < json.length; i++) {
                        html += '<tr class="orderRow">';
                        $.each(json[i], function (key, value) {
                            var name = '';
                            var description = '';
                            if (key === 'OrderName' || key === 'CustomerName') {
                                name = value;
                            } else if (key === 'Description') {
                                description = value;
                            }
                            html += '<td>' + name + '</td>'
                            html += '<td>' + description + '</td>'
                        });
                        html += '</tr>';
                    }
                    $('#tableOrders').append(html);
                    $('#tableOrders').removeAttr('hidden')
                },
                error: function (ex) {
                    var r = $.parseJSON(response.responseText);
                    alert("Message: " + r.Message);
                }
            });
        }
    </script>
</head>

<body>
    <header>
        <h1>
            Service Manager API - Customers
        </h1>
    </header>

    <main>
        <div>
            <h2>All Services</h2>
            <ul id="services" />
        </div>

        <hr />
        <div>
            <h2>Search Services by ID</h2>
            <input type="text" id="serviceId" />
            <input type="button" value="Search" onclick="findServiceByID();" />
            <br />
            <p id="service" />
            <br />
            <div>
                <label for="service">Service Name: </label>
                <input type="text" name="service" id="serviceName" />
                <label for="description">Description: </label>
                <input type="text" name="description" id="description" />
            </div>
            <input type="button" value="Edit" onclick="updateItem()" />
        </div>

        <hr />
        <h2>Create a Service</h2>
        <form id="serviceForm" action="/api/services" method="post" enctype="application/x-www-form-urlencoded">
            <div>
                <label for="serviceName">Service Name: </label>
            </div>
            <div>
                <input name="serviceName" type="text" />
            </div>
            <div>
                <label for="description">Description: </label>
            </div>
            <div>
                <input name="description" type="text" />
            </div>
            <br />
            <div>
                <input type="submit" value="Submit" />
            </div>
        </form>

        <div>
            <h2>List Orders</h2>
            <label for="customer">Customer's ID: </label>
            <input type="text" id="customerId" name="customer" />

            <table id="tableOrders" hidden>
                <tr>
                    <th>
                        Order Name:
                    </th>
                    <th>
                        Description:
                    </th>
                </tr>
            </table>
            <input type="button" value="Search" onclick="getServicesFromDB();" />
        </div>
    </main>

    <footer>
        <h5>
            Alexander Yanev - Web API
        </h5>
    </footer>
</body>
</html>